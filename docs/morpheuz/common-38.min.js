function mCommonConst(){return{sampleIntervalMins:10}}function mCommonLang(){return{noSleep:"No sleep has been recorded yet. If this is incorrect, select the 'Resend' menu option on your watch and check again in a few minutes.",sleepSummary:"Your body and brain requires {0} to {1} hours sleep every night. Last night was {2} as you slept for {3}. Of that sleep: {4} was restless; {5} was light; {6} was deep; {7} was excluded as it either wasn't recorded, or you marked it to be ignored.",sleepSummaryNoRecommend:"You slept for {0}. Of that sleep: {1} was restless; {2} was light; {3} was deep; {4} was excluded as it either wasn't recorded, or you marked it to be ignored.",minutes:" minutes",minute:" minute",hour:" hour",hours:" hours",none:"none",tooLittle:"too little",tooMuch:"too much",ideal:"ideal"}}function mThres(){return{awakeAbove:1000,lightAbove:120}}Date.prototype.format=function(d){var b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"i+":this.getHours()+1,"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(d)){d=d.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var c in e){if(new RegExp("("+c+")").test(d)){d=d.replace(RegExp.$1,RegExp.$1.length==1?e[c]:("00"+e[c]).substr((""+e[c]).length))}}if(/(N+)/.test(d)){d=d.replace(RegExp.$1,b[this.getMonth()])}if(/(W+)/.test(d)){d=d.replace(RegExp.$1,a[this.getDay()])}return d};Date.prototype.addMinutes=function(b){var a=new Date(this.getTime());return new Date(a.getTime()+b*60000)};String.prototype.format=function(){var c=this;for(var a=0;a<arguments.length;a++){var b="{"+a+"}";c=c.replace(b,arguments[a])}return c};function nvl(b,a){return b===null||b==="null"||typeof b==="undefined"?a:b}function fixLen(a){if(a===null||a.length>1){return a}return"0"+a}function hrsmin(d){if(d===0){return mCommonLang().none}var a="";var b=Math.floor(d/60);if(b==1){a+=b+mCommonLang().hour}else{if(b>1){a+=b+mCommonLang().hours}}var c=d%60;if(c!==0){if(b===0){if(c===1){a+=fixLen(String(c))+mCommonLang().minute}else{a+=fixLen(String(c))+mCommonLang().minutes}}else{a+=" "+fixLen(String(c))}}return a}function getUserAgent(){if(typeof navigator==="undefined"||typeof navigator.userAgent==="undefined"){return"unknown"}else{return(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))?"iOS":"Android"}}function calculateStats(h,m,g){var b=new Date(h);var r=true;var c=null;var a=null;var s=null;var u=null;var l=null;var n=null;for(var w=0;w<g.length;w++){if(g[w]===""){continue}var y=parseInt(g[w],10);var e=b.format("hhmm");var q=b;b=b.addMinutes(mCommonConst().sampleIntervalMins);var d=b.format("hhmm");if(m!="N"&&m>=e&&m<=d){a=returnAbsoluteMatch(q,b,m);l=w;break}else{if(y!=-1&&y!=-2&&y<=mThres().awakeAbove){if(r){c=q;u=w;r=false}s=b;n=w}}}if(a===null&&s!==null){a=s;l=n}var o=0;var v=0;var f=0;var x=0;if(u!==null&&l!==null){for(var t=u;t<=l;t++){if(g[t]===""){continue}var k=parseInt(g[t],10);if(k==-1||k==-2){x++}else{if(k>mThres().awakeAbove){o++}else{if(k>mThres().lightAbove){f++}else{v++}}}}}var p=a-c;var z=Math.round((p/1000)/60);return{tbegin:c,tends:a,deep:v*mCommonConst().sampleIntervalMins,light:f*mCommonConst().sampleIntervalMins,awake:o*mCommonConst().sampleIntervalMins,ignore:x*mCommonConst().sampleIntervalMins,total:z}}function returnAbsoluteMatch(e,b,c){var a=e;while(a.getTime()<b.getTime()){var d=a.format("hhmm");if(c===d){return a}a=a.addMinutes(1)}return e}function generateRecommendation(d,f){if(isNaN(d)){return null}var c=parseInt(d,10);if(isNaN(c)){return null}var e=0;var a=0;if(c<1){return"-"}else{if(c<3){e=11;a=14}else{if(c<6){e=10;a=13}else{if(c<14){e=9;a=11}else{if(c<18){e=8;a=10}else{if(c<64){e=7;a=9}else{e=7;a=8}}}}}}var g=Math.floor(f/60);var b="";if(g<e){b=mCommonLang().tooLittle}else{if(g>a){b=mCommonLang().tooMuch}else{b=mCommonLang().ideal}}return{min:e,max:a,view:b}}function buildRecommendationPhrase(a,c){if(c.total===0){return mCommonLang().noSleep}var b=generateRecommendation(a,c.total);if(b!==null){return mCommonLang().sleepSummary.format(b.min,b.max,b.view,hrsmin(c.total),hrsmin(c.awake),hrsmin(c.light),hrsmin(c.deep),hrsmin(c.ignore))}else{return mCommonLang().sleepSummaryNoRecommend.format(hrsmin(c.total),hrsmin(c.awake),hrsmin(c.light),hrsmin(c.deep),hrsmin(c.ignore))}}function generateCopyLinkData(a,k,j,m,g,l,d,c){var b=new Date(a);var f="<pre>";for(var e=0;e<k.length;e++){if(k[e]===""){continue}f=f+b.format("hh:mm")+","+k[e]+"<br/>";b=b.addMinutes(mCommonConst().sampleIntervalMins)}if(j){f=f+m+":"+g+",START<br/>"+l+":"+d+",END<br/>";if(c!="N"){var h=c.substr(0,2)+":"+c.substr(2,2);f=f+h+",ALARM<br/>"}}return{body:f+"</pre>"}};